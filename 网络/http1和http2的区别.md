# http1 和 http2 的区别

## 一、HTTP/1.1的缺陷

1. 高延迟--带来页面加载速度的降低

- 网络延迟问题主要由于队头阻塞(Head-Of-Line Blocking),导致带宽无法被充分利用。
- 队头阻塞是指当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的所有请求也一并被阻塞，会导致客户端迟迟收不到数据。

2. 无状态特性--带来的巨大HTTP头部

- 由于报文Header一般会携带"User Agent""Cookie""Accept""Server"等许多固定的头字段（如下图），多达几百字节甚至上千字节，但Body却经常只有几十字节（比如GET请求、204/301/304响应），成了不折不扣的“大头儿子”。Header里携带的内容过大，在一定程度上增加了传输的成本。更要命的是，成千上万的请求响应报文里有很多字段值都是重复的，非常浪费。

3. 明文传输--带来的不安全性

- HTTP/1.1在传输数据时，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份，这在一定程度上无法保证数据的安全性。

4. 不支持服务器推送消息


## 二、HTTP/2 新特性 （2015年）

1. 二进制传输

HTTP/2传输数据量的大幅减少,主要有两个原因:以二进制方式传输和Header 压缩。我们先来介绍二进制传输，HTTP/2 采用二进制格式传输数据，而非HTTP/1.x 里纯文本形式的报文 ，二进制协议解析起来更高效。 HTTP/2 将请求和响应数据分割为更小的帧，并且它们采用二进制编码。

2. Header 压缩

HTTP/2并没有使用传统的压缩算法，而是开发了专门的"HPACK”算法，在客户端和服务器两端建立“字典”，用索引号表示重复的字符串，还采用哈夫曼编码来压缩整数和字符串，可以达到50%~90%的高压缩率。

3. 多路复用

在 HTTP/2 中引入了多路复用的技术。多路复用很好的解决了浏览器限制同一个域名下的请求数量的问题，从而避免了 HTTP/1 中的队头阻塞问题，同时也更容易实现全速传输，毕竟新开一个 TCP 连接都需要慢慢提升传输速度。

4. Server Push

HTTP2还在一定程度上改变了传统的“请求-应答”工作模式，服务器不再是完全被动地响应请求，也可以新建“流”主动向客户端发送消息。

比如，在浏览器刚请求HTML的时候就提前把可能会用到的JS、CSS文件发给客户端，减少等待的延迟，这被称为"服务器推送"（ Server Push，也叫 Cache push）

5. 提高安全性

出于兼容的考虑，HTTP/2延续了HTTP/1的“明文”特点，可以像以前一样使用明文传输数据，不强制使用加密通信，不过格式还是二进制，只是不需要解密。

## 三、HTTP 3（2022年）：

HTTP 3（HTTP over QUIC）是HTTP协议的最新版本，旨在提供比HTTP 2更快的性能和更好的网络适应性。HTTP 3基于QUIC（Quick UDP Internet Connections）协议，这是一个由Google开发的新传输层协议，旨在解决TCP的一些问题，如队头阻塞、连接建立延迟等。

HTTP 3的主要特点包括：

1. **快速连接建立**：QUIC协议使用UDP作为底层传输协议，避免了TCP的握手延迟，从而实现了快速连接建立。

2. **多路复用**：HTTP 3支持多路复用，允许同时通过单一的HTTP/3连接发起多个请求和响应，避免了“队头阻塞”问题。

3. **更好的网络适应性**：QUIC协议支持动态调整拥塞控制算法，能够更好地适应不同的网络环境。

4. **安全性**：HTTP 3要求使用TLS（传输层安全协议），提供了数据传输的安全性。

HTTP 3的推出是为了解决HTTP 2中的一些问题，提高网页加载速度和用户体验。随着HTTP 3的普及，未来可能会有更多的网站和应用程序采用HTTP 3协议。

## 1.0 \ 1.1 \ 2

- http 1.0要指定keep-alive来开启持久连接，默认是短连接，就是浏览器每次请求都要重新建立一次tcp连接，完事儿了就释放tcp连接。其实最慢的不是发送请求和获取响应，打开和释放连接，这都是很重的过程

- http 1.1默认支持长连接，就是说，浏览器打开一个网页之后，底层的tcp连接就保持着，不会立马断开，之后加载css、js之类的请求，都会基于这个tcp连接来走。http 1.1还支持host头，也就可以支持虚拟主机；而且对断点续传有支持。

- http 2.0，支持多路复用，基于一个tcp连接并行发送多个请求以及接收响应，解决了http 1.1对同一时间同一个域名的请求有限制的问题。二进制分帧，将传输数据拆分为更小的帧（数据包），frame（数据包，帧），提高了性能，实现低延迟高吞吐。

